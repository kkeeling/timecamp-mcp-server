<!-- 
This file is automatically maintained by Claude Code to track project decisions and recent work.
It helps team members quickly understand the project context and continue where others left off.
Generated by Claude Code's stop hook - feel free to edit manually if needed.
-->

# Key Decisions

* [DEPRECATED] Decided to enable direct GitHub installation of the TimeCamp MCP server using modern Python packaging: add `pyproject.toml`, define `console_scripts` entry point, update project structure and README; support installation via `pipx` and `uv`/`uvx`.  
  Reason: GitHub installation approach was found to be unreliable and has been reverted.
* [DEPRECATED] Decided to revert to a manual clone-and-install workflow for the TimeCamp MCP server: update README to instruct users to `git clone`, run `pip install -e .`, and configure their MCP client (e.g., Cloud Desktop) to point to the local path via `python -m timecamp_mcp_server`.  
  Reason: Simplify local development after GitHub packaging issues.
* Decided to provide a UV-based single-file script distribution (`timecamp-server.py`) with a PEP 723 inline header for declaring dependencies; updated README to recommend this UV-based approach as the primary method, while retaining the traditional package installation as a fallback.  
  Reason: Simplify deployment with no installation required, enable easy one-file sharing, and leverage UV’s automatic dependency management.
* Decided to remove all other installation workflows and exclusively support the UV single-file `timecamp-server.py` script: deleted the `src` directory, legacy test files, `pyproject.toml`, `requirements.txt`, and related packaging artifacts.  
  Reason: Streamline the codebase, eliminate redundant code paths, and focus on a single, maintainable deployment method.
* Decided to upgrade FastMCP to version 2.8.0 (from 0.8.0) in `timecamp-server.py` to leverage its built-in conversion of resources and prompts into tools, ensuring full MCP client compatibility.  
  Reason: Most MCP clients only support tools, so converting resources and prompts to tools guarantees all functionality is exposed.
* Decided to implement explicit tool wrappers for resource endpoints within `timecamp-server.py`—`get_projects`, `get_timer_status`, `get_tasks`, and `get_timecamp_overview`—to expose resource functionality as tools for MCP clients that only support tools and do not make `resources/list` or `prompts/list` calls.  
  Reason: Work around widespread client limitations and ensure resource/prompts data is visible alongside tools.
* [DEPRECATED] Decided to align TimeCampClient with official API by replacing `/time_entries` → `/entries`, `/timer_running` → `/timer`, and removing the “Bearer” prefix from the Authorization header.  
  Reason: Incorrect endpoints and header format were causing redirects and authentication failures.
* Decided to align TimeCampClient with official API endpoints by replacing `/time_entries` → `/entries` and `/timer_running` → `/timer`.  
  Reason: Official API uses `/entries` and `/timer`, preventing redirects and authentication issues.
* Decided to retain the “Bearer” prefix in the Authorization header (`Authorization: Bearer {token}`) as per official documentation.  
  Reason: The API docs explicitly require the 'Bearer' prefix for authentication.
* Decided to use the `/tasks` endpoint for fetching project data instead of a non-existent `/projects` endpoint.  
  Reason: TimeCamp’s API organizes projects, subprojects, and tasks hierarchically under `/tasks`, and there is no `/projects` endpoint.
* [DEPRECATED] Decided to align TimeCampClient with official API endpoints by replacing `/timer_running` → `/timer`.  
  Reason: `/timer` endpoint returns 404 errors in practice, making `/timer_running` unreliable.
* Decided to continue using the `/timer_running` endpoint instead of `/timer`.  
  Reason: `/timer_running` returns correct timer status while `/timer` returns 404.
* Decided to use base URL `https://app.timecamp.com` instead of `https://www.timecamp.com` for all API requests.  
  Reason: The `www` domain returned 404 errors.
* Decided to parse XML responses from the TimeCamp API by adding an `_xml_to_dict()` converter using `xml.etree.ElementTree`.  
  Reason: The API returns XML data rather than JSON, requiring XML parsing.
* Decided to replace references to the `id` key with `task_id` for TimeCamp API resources when parsing project and task identifiers.  
  Reason: The TimeCamp API returns `task_id` instead of `id`, and updating the parsing logic prevents KeyError exceptions and ensures correct resource identification.
* Decided to remove ambiguous `id` fallback in timer functions (e.g., `stop_timer`) to ensure strict use of `task_id` and prevent potential KeyError issues.  
  Reason: Ensures consistency across timer operations and aligns with API’s `task_id` identifier.

# Recent Work

* August 2, 2025 – Removed ambiguous `id` checks in timer functions (`stop_timer` and others), ensuring consistent use of `task_id`; updated tests and ran full pre-commit validation.
* August 1, 2025 – Fixed two medium severity issues identified by pre-commit validation: updated Pydantic models `TimeCampProject` and `TimeCampTask` to use `task_id` instead of `id`, and removed ambiguous `or result.get('id')` checks in two locations (lines 544 and 773).
* July 26, 2025 – Updated `test_timecamp_api.py` to include a PEP 723 UV preamble for dependency management, added usage instructions for `uv run`, and aligned test execution with the main `timecamp-server.py` script approach.
* July 25, 2025 – Updated TimeCampClient to handle XML responses, corrected base URL to `app.timecamp.com`, reverted to `/timer_running` endpoint due to `/timer` returning 404, implemented `_xml_to_dict()` for XML-to-dict conversion, and created/runs a comprehensive test script verifying `/tasks`, `/entries`, and `/timer_running`.
* July 24, 2025 – Identified that TimeCamp API does not provide a `/projects` endpoint; confirmed that `/tasks` is used for all project data in a hierarchical structure and documented incorrect `/projects` usage.

# Next Steps

* Test installation workflows against identified example patterns (disler/aider-mcp-server, evalstate/mcp-py-repl, vectara/vectara-mcp) and validate the new UV single-file script approach
* Deploy to production environment
* Monitor performance metrics with the new caching system
* Consider implementing more robust ETag generation with JSON serialization
* Add comprehensive logging throughout the application
* Create deployment documentation and Docker configuration
* Set up monitoring and alerting for the MCP server
* Test and verify that new tool wrappers appear correctly in Claude Code and other MCP clients
* Evaluate migrating from FastMCP to the official `mcp` library for finer-grained protocol control
* Rotate API token after testing
* Update README to document XML response handling and base URL change